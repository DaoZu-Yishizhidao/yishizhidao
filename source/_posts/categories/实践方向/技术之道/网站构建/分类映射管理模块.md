---
categories:
  - å®è·µæ–¹å‘
  - æŠ€æœ¯ä¹‹é“
  - ç½‘ç«™æ„å»º
title: åˆ†ç±»æ˜ å°„ç®¡ç†æ¨¡å—
permalink: categories/practice/technology/website-build/1770135975382/
date: 2026-02-04 00:26:23
writing_date: 2026-02-04 00:26:23
excerpt: è·å–è„šæœ¬å½“å‰ç›®å½•ï¼Œè®¾ç½®æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
hide: true
tags:
---

# åˆ†ç±»æ˜ å°„ç®¡ç†æ¨¡å—

```powershell

# ============================================
# ã€Šæ„è¯†ä¹‹é“ã€‹æ™ºèƒ½æ–‡ç« åˆ›å»ºè„šæœ¬
# ä½œè€…ï¼šé“ç¥–
# ç‰ˆæœ¬ï¼šv1 
# æ—¥æœŸï¼š2026-02-04 00ï¼š10
# æ›´æ–°æ—¥æœŸï¼š2026-02-04 00ï¼š10
# ============================================



# åˆ†ç±»æ˜ å°„ç®¡ç†æ¨¡å—

# è·å–è„šæœ¬å½“å‰ç›®å½•
$scriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$rootDir = Split-Path -Parent $scriptDir

# è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
$script:jsonFilePath = Join-Path $rootDir "category_map.json"
$script:yamlConfigPath = Join-Path $rootDir "_config.yml"

$script:VerboseOutput = $false  # é»˜è®¤ä¸è¾“å‡ºè¯¦ç»†æ—¥å¿—

Write-Verbose "æ¨¡å—è·¯å¾„: $scriptDir"
Write-Verbose "é¡¹ç›®æ ¹ç›®å½•: $rootDir"
Write-Verbose "JSONæ–‡ä»¶è·¯å¾„: $script:jsonFilePath"
Write-Verbose "YAMLæ–‡ä»¶è·¯å¾„: $script:yamlConfigPath"

function Get-CategoryMapFromYaml {

    if ($script:VerboseOutput) {
        Write-Host "ğŸ“„ ä» YAML æ–‡ä»¶åŠ è½½åˆ†ç±»æ˜ å°„..." -ForegroundColor Gray
        Write-Host "   æ–‡ä»¶è·¯å¾„: $script:yamlConfigPath" -ForegroundColor DarkGray
    }

    
    if (-not (Test-Path $script:yamlConfigPath)) {
        Write-Host "âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $script:yamlConfigPath" -ForegroundColor Red
        return @{}
    }
    
    try {
        # è¯»å–æ–‡ä»¶å†…å®¹
        $content = Get-Content $script:yamlConfigPath -Raw
        Write-Verbose "æ–‡ä»¶å¤§å°: $($content.Length) å­—ç¬¦"
        
        $categoryMap = @{}
        $foundCount = 0
        
        # è°ƒè¯•ï¼šæ˜¾ç¤ºå‰200ä¸ªå­—ç¬¦
        if ($content.Length > 200) {
            Write-Verbose "æ–‡ä»¶å‰200å­—ç¬¦: $($content.Substring(0, 200))"
        }
        
        # æŸ¥æ‰¾ category_map éƒ¨åˆ†
        if ($content -match '(?sm)category_map:(.*?)(?=\n[^\s#]|\Z)') {
            $mapSection = $matches[1]
            Write-Verbose "æ‰¾åˆ° category_map é…ç½®æ®µ"
            Write-Verbose "é…ç½®æ®µå†…å®¹: $mapSection"
            
            # è§£ææ¯ä¸€è¡Œ
            $lines = $mapSection -split "`n"
            foreach ($line in $lines) {
                $line = $line.Trim()
                
                # è·³è¿‡æ³¨é‡Šè¡Œå’Œç©ºè¡Œ
                if ($line -and $line -notmatch '^\s*#') {
                    # åŒ¹é…é”®å€¼å¯¹
                    if ($line -match '^\s*([^#:]+?)\s*:\s*([^#\s]+)') {
                        $key = $matches[1].Trim()
                        $value = $matches[2].Trim()
                        
                        # ç¡®ä¿ä¸æ˜¯ç©ºé”®å€¼ï¼Œä¸”ä¸æ˜¯ category_map æœ¬èº«
                        if ($key -and $value) { 
                            $categoryMap[$key] = $value
                            $foundCount++
                            if ($script:VerboseOutput) {
                                Write-Host "   æ˜ å°„: $key â†’ $value" -ForegroundColor Green
                            }
                            
                        }
                    }
                }
            }
        }
        else {
            Write-Host "âŒ æœªæ‰¾åˆ° category_map é…ç½®æ®µ" -ForegroundColor Red
            
            # å°è¯•é€è¡ŒæŸ¥æ‰¾
            Write-Host "   å°è¯•é€è¡ŒæŸ¥æ‰¾ category_map..." -ForegroundColor Yellow
            $lines = $content -split "`n"
            $inCategoryMap = $false
            
            foreach ($line in $lines) {
                if ($line.Trim() -eq 'category_map:') {
                    $inCategoryMap = $true
                    continue
                }
                
                # ç»“æŸæ¡ä»¶ï¼šé‡åˆ°æ–°çš„é¡¶çº§é…ç½®é¡¹ï¼ˆä¸ä»¥ç©ºæ ¼å¼€å¤´ï¼‰
                if ($inCategoryMap -and $line -match '^\S' -and $line.Trim() -notmatch '^\s*#') {
                    $inCategoryMap = $false
                    continue
                }
                
                # åœ¨category_mapèŒƒå›´å†…è§£æé”®å€¼å¯¹
                if ($inCategoryMap -and $line -match '^\s*([^#:]+?)\s*:\s*([^#\s]+)') {
                    $key = $matches[1].Trim()
                    $value = $matches[2].Trim()
                    
                    if ($key -and $value) {
                        $categoryMap[$key] = $value
                        $foundCount++
                        if ($script:VerboseOutput) {
                            Write-Host "   æ˜ å°„: $key â†’ $value" -ForegroundColor Green
                        }
                    }
                }
            }
        }
        
        if ($foundCount -gt 0) {
            if ($script:VerboseOutput) {
                Write-Host "âœ… ä» YAML æ–‡ä»¶åŠ è½½äº† $foundCount ä¸ªåˆ†ç±»æ˜ å°„" -ForegroundColor Green
            }
            return $categoryMap
        } else {
            Write-Host "âš ï¸  ä» YAML æ–‡ä»¶æœªæ‰¾åˆ°åˆ†ç±»æ˜ å°„" -ForegroundColor Yellow
            return @{}
        }
    }
    catch {
        Write-Host "âŒ è§£æ YAML æ–‡ä»¶æ—¶å‡ºé”™: $_" -ForegroundColor Red
        return @{}
    }
}

function Get-CategoryMapFromJson {
    if ($script:VerboseOutput) {
        Write-Host "ğŸ“„ ä» JSON æ–‡ä»¶åŠ è½½åˆ†ç±»æ˜ å°„..." -ForegroundColor Gray
        Write-Host "   æ–‡ä»¶è·¯å¾„: $script:jsonFilePath" -ForegroundColor DarkGray
    }
    
    if (-not (Test-Path $script:jsonFilePath)) {
        Write-Host "ğŸ“„ JSON æ–‡ä»¶ä¸å­˜åœ¨: $script:jsonFilePath" -ForegroundColor Gray
        return @{}
    }
    
    try {
        $jsonContent = Get-Content $script:jsonFilePath -Raw
        if ([string]::IsNullOrWhiteSpace($jsonContent)) {
            Write-Host "âš ï¸  JSON æ–‡ä»¶ä¸ºç©º" -ForegroundColor Yellow
            return @{}
        }
        
        # ç§»é™¤æ³¨é‡Šè¡Œ
        $cleanContent = $jsonContent -replace '(?m)^\s*#.*\n?', ''
        
        $jsonMap = $cleanContent | ConvertFrom-Json -AsHashtable
        
        if ($jsonMap -and $jsonMap.Count -gt 0) {
            if ($script:VerboseOutput) {
                Write-Host "âœ… ä» JSON æ–‡ä»¶åŠ è½½äº† $($jsonMap.Count) ä¸ªåˆ†ç±»æ˜ å°„" -ForegroundColor Green
            }
            
            return $jsonMap
        } else {
            Write-Host "âš ï¸  JSON æ–‡ä»¶æ²¡æœ‰æœ‰æ•ˆæ•°æ®" -ForegroundColor Yellow
            return @{}
        }
    }
    catch {
        Write-Host "âŒ è§£æ JSON æ–‡ä»¶æ—¶å‡ºé”™: $_" -ForegroundColor Red
        return @{}
    }
}

function Save-CategoryMapToJson {
    param(
        [Parameter(Mandatory=$true)]
        [hashtable]$CategoryMap,
        [switch]$Force = $false
    )
    
    if ($CategoryMap.Count -eq 0 -and -not $Force) {
        Write-Host "âš ï¸  æ²¡æœ‰æ˜ å°„æ•°æ®å¯ä¿å­˜" -ForegroundColor Yellow
        return $false
    }
    
    try {
        # å°† Hashtable è½¬æ¢ä¸ºæœ‰åºå¯¹è±¡ä»¥ä¾¿ç¾è§‚è¾“å‡º
        $orderedMap = [ordered]@{}
        $CategoryMap.Keys | Sort-Object | ForEach-Object {
            $orderedMap[$_] = $CategoryMap[$_]
        }
        
        $jsonContent = $orderedMap | ConvertTo-Json -Depth 10
        
        # æ·»åŠ æ³¨é‡Šå’Œæ ¼å¼
        $fullContent = @"
$jsonContent
"@
        
        Set-Content -Path $script:jsonFilePath -Value $fullContent -Encoding UTF8
        Write-Host "ğŸ’¾ å·²ä¿å­˜ $($CategoryMap.Count) ä¸ªæ˜ å°„åˆ° $script:jsonFilePath" -ForegroundColor Green
        
        return $true
    }
    catch {
        Write-Host "âŒ ä¿å­˜ JSON æ–‡ä»¶æ—¶å‡ºé”™: $_" -ForegroundColor Red
        return $false
    }
}

function Get-CategoryMap {
    [CmdletBinding()]
    param(
        [switch]$Silent = $false
    )
    $script:VerboseOutput = -not $Silent
    # é¦–å…ˆå°è¯•ä» YAML åŠ è½½
    $yamlMap = Get-CategoryMapFromYaml
    
    if ($yamlMap.Count -gt 0) {

        if($script:VerboseOutput) {
            Write-Host "âœ… æˆåŠŸä» _config.yml åŠ è½½åˆ†ç±»æ˜ å°„" -ForegroundColor Green
        }
          
        # æ£€æŸ¥ JSON æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        $jsonMap = Get-CategoryMapFromJson
        
        if ($jsonMap.Count -eq 0) {
            # JSON æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ›å»ºæ–°æ–‡ä»¶
            Write-Host "ğŸ“ åˆ›å»ºæ–°çš„ JSON æ˜ å°„æ–‡ä»¶..." -ForegroundColor Yellow
            Save-CategoryMapToJson -CategoryMap $yamlMap | Out-Null
        }
        
        return $yamlMap
    }
    else {
        # YAML åŠ è½½å¤±è´¥ï¼Œå°è¯•ä» JSON åŠ è½½
        Write-Host "âš ï¸  æ— æ³•ä» _config.yml åŠ è½½æ˜ å°„ï¼Œå°è¯• JSON æ–‡ä»¶..." -ForegroundColor Yellow
        
        $jsonMap = Get-CategoryMapFromJson
        
        if ($jsonMap.Count -gt 0) {
            Write-Host "âœ… ä» JSON æ–‡ä»¶æˆåŠŸåŠ è½½åˆ†ç±»æ˜ å°„" -ForegroundColor Green
            return $jsonMap
        }
        else {
            # ä¸¤è€…éƒ½å¤±è´¥ï¼Œåˆ›å»ºé»˜è®¤æ˜ å°„
            Write-Host "âŒ æ— æ³•ä»ä»»ä½•æºåŠ è½½åˆ†ç±»æ˜ å°„" -ForegroundColor Red
            Write-Host "ğŸ“ æ­£åœ¨åˆ›å»ºé»˜è®¤æ˜ å°„æ–‡ä»¶..." -ForegroundColor Yellow
            
            $defaultMap = @{
                'é“ç»å·' = 'dao-scripture'
                'æ³•åˆ™ç¯‡' = 'principles'
                'é“æ¼”ç¯‡' = 'evolution'
                'é“å¢ƒå·' = 'dao-state'
                'é“å¢ƒä¹‹é—¨' = 'gate'
                'å¢ƒç•Œè®ºè¿°' = 'state-discussion'
                'å®ä¿®æ ¹æœ¬' = 'foundation'
                'å®ä¿®ç»' = 'scripture'
                'å®ä¿®ç†æœ¯' = 'methods'
                'å®è·µæ–¹å‘' = 'practice'
                'å“²å­¦ä¹‹é“' = 'philosophy'
                'ç§‘å­¦ä¹‹é“' = 'science'
                'æŠ€æœ¯ä¹‹é“' = 'technology'
                'é“ç¥–ä¹‹é“' = 'daozu'
                'é“è®º' = 'discussion'
                'å‚è€ƒ' = 'reference'
                'ç½‘ç«™æ„å»º' = 'website-build'
            }
            
            # åˆ›å»º JSON æ–‡ä»¶
            Save-CategoryMapToJson -CategoryMap $defaultMap | Out-Null
            Write-Host "ğŸ“„ å·²åˆ›å»ºé»˜è®¤æ˜ å°„æ–‡ä»¶ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹" -ForegroundColor Green
            
            return $defaultMap
        }
    }
}

Export-ModuleMember -Function Get-CategoryMap

```