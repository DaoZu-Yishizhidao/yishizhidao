---
categories:
  - å®è·µæ–¹å‘
  - æŠ€æœ¯ä¹‹é“
  - ç½‘ç«™æ„å»º
title: æ™ºèƒ½æ–‡ç« åˆ›å»ºè„šæœ¬
permalink: categories/practice/technology/website-build/1770136210495/
date: 2026-02-04 00:30:13
writing_date: 2026-02-04 00:30:13
excerpt: ç»¼åˆä¸‰ä¸ªè„šæœ¬æ¨¡å—ï¼Œå®ç°æ–°æ–‡ç« è‡ªåŠ¨åŒ–åˆ†ç±»è‡³æŒ‡å®šåˆ†ç±»ç›®å½•
hide: true
tags:
---

# æ™ºèƒ½æ–‡ç« åˆ›å»ºè„šæœ¬



```powershell
# ============================================
# ã€Šæ„è¯†ä¹‹é“ã€‹æ™ºèƒ½æ–‡ç« åˆ›å»ºè„šæœ¬
# ä½œè€…ï¼šé“ç¥–
# ç‰ˆæœ¬ï¼šv1 
# æ—¥æœŸï¼š2026-02-04 00ï¼š10
# æ›´æ–°æ—¥æœŸï¼š2026-02-04 00ï¼š10
# ============================================



param(
    [Parameter(Mandatory=$true)]
    [string]$category,
    
    [string]$title,
    [switch]$ShowDetails = $false
)

# å¯¼å…¥æ¨¡å—
$modulesDir = "./psm-modules"
$modules = @(
    "$modulesDir\CategoryMap.psm1",
    "$modulesDir\FolderTree.psm1", 
    "$modulesDir\PathConverter.psm1"
)

foreach ($module in $modules) {
    if (Test-Path $module) {
        try {
            Import-Module $module -Force -ErrorAction Stop
            if ($ShowDetails) {
                Write-Host "âœ… å¯¼å…¥æ¨¡å—: $(Split-Path $module -Leaf)" -ForegroundColor Green
            }
        }
        catch {
            Write-Host "âŒ æ— æ³•å¯¼å…¥æ¨¡å— $module : $_" -ForegroundColor Red
            exit 1
        }
    }
    else {
        Write-Host "âŒ æ¨¡å—æ–‡ä»¶ä¸å­˜åœ¨: $module" -ForegroundColor Red
        Write-Host "è¯·ç¡®ä¿ä»¥ä¸‹æ¨¡å—æ–‡ä»¶å­˜åœ¨:" -ForegroundColor Yellow
        $modules | ForEach-Object { Write-Host "  â€¢ $_" -ForegroundColor Gray }
        exit 1
    }
}

# 1. åŠ è½½åˆ†ç±»æ˜ å°„
$categoryMap = Get-CategoryMap -Silent:(!$ShowDetails)
if ($categoryMap.Count -eq 0) {
    Write-Host "âŒ æ— æ³•åŠ è½½åˆ†ç±»æ˜ å°„" -ForegroundColor Red
    exit 1
}

# 2. æ‰«æç›®å½•ç»“æ„
$tree = Get-FolderTree -RootPath "source/_posts" -Silent:(!$ShowDetails)
if (-not $tree) {
    Write-Host "âŒ æ— æ³•æ‰«æç›®å½•ç»“æ„" -ForegroundColor Red
    exit 1
}

# 3. æœç´¢æ–‡ä»¶å¤¹
$foundFolders = $tree.Find($category)

if ($foundFolders -and $foundFolders.Count -gt 0) {
    # å¦‚æœæœ‰å¤šä¸ªåŒ¹é…ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ª
    if ($foundFolders.Count -gt 1) {
        if ($ShowDetails) {
            Write-Host "âš ï¸  æ‰¾åˆ°å¤šä¸ªåŒ¹é…çš„æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ª" -ForegroundColor Yellow
            $foundFolders | ForEach-Object { Write-Host "  â€¢ $_" -ForegroundColor Gray }
        }
        $foundFolder = $foundFolders[0]
    } else {
        $foundFolder = $foundFolders
    }
    
    # æ˜¾ç¤ºæ‰¾åˆ°çš„æ–‡ä»¶å¤¹
    if ($ShowDetails) {
        Write-Host "âœ… æ‰¾åˆ°æ–‡ä»¶å¤¹: $foundFolder" -ForegroundColor Green
        
        # æ˜¾ç¤ºè·¯å¾„è½¬æ¢
        $englishPath = Convert-PathToEnglish -RelativePath $foundFolder -CategoryMap $categoryMap
        Write-Host "ğŸ“ åŸå§‹è·¯å¾„ (ä¸­æ–‡): $foundFolder" -ForegroundColor Yellow
        Write-Host "ğŸ”¤ è½¬æ¢è·¯å¾„ (è‹±æ–‡): $englishPath" -ForegroundColor Cyan
    }
    
    # å¦‚æœæä¾›äº†æ ‡é¢˜ï¼Œåˆ™åˆ›å»ºæ–‡ç« 
    if ($title) {
        # å¤„ç†æ–‡ç« æ ‡é¢˜å’ŒURL
        $postName = $title
        if ($category -eq $title) {
            $posturl = "index"
        } else {
            # ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºURLçš„ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿å”¯ä¸€æ€§
            $timestamp = [DateTimeOffset]::Now.ToUnixTimeMilliseconds()
            $posturl = "$timestamp"
        }


        # æ„å»ºåˆ†ç±»å­—ç¬¦ä¸²,é™¤å»æ ¹èŠ‚ç‚¹categonries
        $categories=$foundFolder
        $categories=$categories.Replace($($tree.GetSubfolders("")+"/"),"[")
        $categories=$categories.Replace("/",",")+"]"
        
        $categories
        # æ„å»ºæ°¸ä¹…é“¾æ¥
        $permalink = Convert-PathToEnglish -RelativePath $foundFolder -CategoryMap $categoryMap
        $permalinkPath = "$permalink/$posturl/"
        
        # åˆ›å»ºæ–°æ–‡ç« 
        $postTemplate = "post.md"
        $newTemplate = "newpost.md"
        $templatePath = Join-Path (Get-Location) "scaffolds\$postTemplate"
        $newTemplatePath = Join-Path (Get-Location) "scaffolds\$newTemplate"
        
        if (Test-Path $templatePath) {
            # å¤åˆ¶æ¨¡æ¿
            Copy-Item $templatePath $newTemplatePath -Force
            
            # æ›´æ–°æ¨¡æ¿å†…å®¹
            $templateContent = Get-Content $newTemplatePath
            
            # æ›¿æ¢permalink
            if ($templateContent -match 'permalink:\s*.*') {
                $templateContent = $templateContent -replace 'permalink:\s*.*', "permalink: /$permalinkPath"
            } else {
                # å¦‚æœæ²¡æœ‰permalinkè¡Œï¼Œæ·»åŠ ä¸€ä¸ª
                $templateContent = $templateContent -replace '---', "---`npermalink: $permalinkPath"
            }
            
            # æ›¿æ¢categories
            if ($templateContent -match 'categories:\s*.*') {
                $templateContent = $templateContent -replace 'categories:\s*.*', "categories: $categories"
            } else {
                # å¦‚æœæ²¡æœ‰categoriesè¡Œï¼Œæ·»åŠ ä¸€ä¸ª
                $templateContent = $templateContent -replace '---', "---`ncategories: $categories"
            }

            # æ›¿æ¢hide
            if ($templateContent -match 'hide:\s*.*') {
                $templateContent = $templateContent -replace 'hide:\s*.*', "hide: ture"
            } else {
                #å¦‚æœæ²¡æœ‰hideè¡Œï¼Œæ·»åŠ ä¸€ä¸ª
                $templateContent = $templateContent -replace '---', "---`nhide: ture"
            }
            
            # æ›¿æ¢titleï¼ˆå¦‚æœæ¨¡æ¿ä¸­æœ‰å ä½ç¬¦ï¼‰
            if ($templateContent -match 'title:\s*{{ title }}') {
                $templateContent = $templateContent -replace 'title:\s*{{ title }}', "title: $title"
            }
            
            Set-Content -Path $newTemplatePath -Value $templateContent -Encoding UTF8
            
            if ($ShowDetails) {
                Write-Host "ğŸ“„ æ›´æ–°æ¨¡æ¿å†…å®¹:" -ForegroundColor Gray
                Write-Host "  permalink: $permalinkPath" -ForegroundColor DarkGray
                Write-Host "  categories: $categories" -ForegroundColor DarkGray
            }
            
            # æ‰§è¡ŒHexoå‘½ä»¤åˆ›å»ºæ–‡ç« 
            try {
                # æ„å»ºå®Œæ•´çš„æ–‡ç« è·¯å¾„
                $fullPostPath = Join-Path (Get-Location) "source/_posts" $foundFolder $title
                $fullPostPath = $fullPostPath.Replace("/", "\") + ".md"
                
                Write-Host "ğŸ“ åˆ›å»ºæ–‡ç« : $title" -ForegroundColor Cyan
                Write-Host "ğŸ“ è·¯å¾„: $foundFolder/$title.md" -ForegroundColor Gray
                
                # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                if (Test-Path $fullPostPath) {
                    Write-Host "âš ï¸  æ–‡ä»¶å·²å­˜åœ¨: $fullPostPath" -ForegroundColor Yellow
                    $overwrite = Read-Host "æ˜¯å¦è¦†ç›–ï¼Ÿ(y/n)"
                    if ($overwrite -ne 'y') {
                        Write-Host "âŒ å·²å–æ¶ˆåˆ›å»º" -ForegroundColor Red
                        exit 0
                    }
                }
                
                # ä½¿ç”¨Hexoåˆ›å»ºæ–‡ç« 
                hexo new newpost --path "$foundFolder/$title" $title
                
                Write-Host "âœ… æˆåŠŸåˆ›å»ºæ ‡é¢˜ä¸º'$title'çš„æ–‡ç« " -ForegroundColor Green
                Write-Host "ğŸ“ è·¯å¾„: source/_posts/$foundFolder/$title.md" -ForegroundColor Cyan
                
                # æ˜¾ç¤ºå®Œæ•´çš„Front Matter
                if ($ShowDetails) {
                    Write-Host "`nğŸ“‹ æ–‡ç« é…ç½®:" -ForegroundColor Yellow
                    Write-Host "  title: $title" -ForegroundColor Gray
                    Write-Host "  categories: $categories" -ForegroundColor Gray
                    Write-Host "  permalink: $permalinkPath" -ForegroundColor Gray
                    Write-Host "  date: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" -ForegroundColor Gray
                }
            }
            catch {
                Write-Host "âŒ æ‰§è¡ŒHexoå‘½ä»¤æ—¶å‡ºé”™: $_" -ForegroundColor Red
                
                # æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶çš„å¤‡ç”¨æ–¹æ¡ˆ
                Write-Host "å°è¯•æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶..." -ForegroundColor Yellow
                
                $frontMatter = @"
---
title: $title
date: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
updated: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
categories: $categories
permalink: $permalinkPath
tags: []
---
"@
                
                Set-Content -Path $fullPostPath -Value $frontMatter -Encoding UTF8
                Write-Host "âœ… æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶: $fullPostPath" -ForegroundColor Green
            }
            
            # æ¸…ç†ä¸´æ—¶æ¨¡æ¿
            if (Test-Path $newTemplatePath) {
                Remove-Item $newTemplatePath -Force
            }
        }
        else {
            Write-Host "âŒ æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨: $templatePath" -ForegroundColor Red
            Write-Host "è¯·ç¡®ä¿å­˜åœ¨ scaffolds\post.md æ–‡ä»¶" -ForegroundColor Yellow
        }
    }
    else {
        # åªæ˜¾ç¤ºæ–‡ä»¶å¤¹ä¿¡æ¯
        Write-Host "ğŸ“ åŸå§‹è·¯å¾„ (ä¸­æ–‡): $foundFolder" -ForegroundColor Yellow
        
        $englishPath = Convert-PathToEnglish -RelativePath $foundFolder -CategoryMap $categoryMap
        Write-Host "ğŸ”¤ è½¬æ¢è·¯å¾„ (è‹±æ–‡): $englishPath" -ForegroundColor Cyan
        
        Write-Host "`nğŸ’¡ æç¤º: ä½¿ç”¨ -title å‚æ•°åˆ›å»ºæ–‡ç« " -ForegroundColor Gray
        Write-Host "  ä¾‹å¦‚: .\newpost.ps1 -category '$category' -title 'æ–°æ–‡ç« æ ‡é¢˜'" -ForegroundColor DarkGray
    }
}
else {
    Write-Host "âŒ æœªæ‰¾åˆ°åŒ…å« '$category' çš„æ–‡ä»¶å¤¹" -ForegroundColor Red
    
    # æ˜¾ç¤ºå¯ç”¨çš„åˆ†ç±»æ˜ å°„
    if ($categoryMap.Count -gt 0) {
        Write-Host "`nğŸ“‹ å¯ç”¨çš„åˆ†ç±»æ˜ å°„:" -ForegroundColor Yellow
        
        # æŒ‰åˆ†ç»„æ˜¾ç¤º
        $groups = @{
            "é“ç»å·" = $categoryMap.Keys | Where-Object { $_ -match "^é“ç»å·|æ³•åˆ™ç¯‡|é“æ¼”ç¯‡" }
            "é“å¢ƒå·" = $categoryMap.Keys | Where-Object { $_ -match "^é“å¢ƒå·|é“å¢ƒä¹‹é—¨|å¢ƒç•Œè®ºè¿°|å®ä¿®æ ¹æœ¬|å®ä¿®ç»|å®ä¿®ç†æœ¯" }
            "å®è·µæ–¹å‘" = $categoryMap.Keys | Where-Object { $_ -match "^å®è·µæ–¹å‘|å“²å­¦ä¹‹é“|ç§‘å­¦ä¹‹é“|æŠ€æœ¯ä¹‹é“|é“ç¥–ä¹‹é“" }
            "å…¶ä»–" = $categoryMap.Keys | Where-Object { $_ -notmatch "^é“ç»å·|é“å¢ƒå·|å®è·µæ–¹å‘" }
        }
        
        foreach ($groupKey in $groups.Keys) {
            if ($groups[$groupKey].Count -gt 0) {
                Write-Host "`n  ${groupKey}:" -ForegroundColor Cyan
                $groups[$groupKey] | Sort-Object | ForEach-Object {
                    Write-Host "    â€¢ $_ â†’ $($categoryMap[$_])" -ForegroundColor DarkGray
                }
            }
        }
    }
    
    # æ˜¾ç¤ºé¡¶å±‚æ–‡ä»¶å¤¹
    Write-Host "`nğŸ“ å¯ç”¨çš„é¡¶å±‚æ–‡ä»¶å¤¹:" -ForegroundColor Yellow
    
    # æ·»åŠ GetSubfoldersæ–¹æ³•åˆ°$treeå¯¹è±¡ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    if (-not ($tree | Get-Member -Name GetSubfolders -MemberType ScriptMethod)) {
        $tree | Add-Member -MemberType ScriptMethod -Name GetSubfolders -Value {
            param([string]$ParentPath)
            if (-not $ParentPath) {
                return $this.AllFolders | Where-Object { $_ -notmatch "/" }
            }
            $this.AllFolders | Where-Object { $_ -like "$ParentPath/*" -and $_ -ne $ParentPath }
        }
    }
    
    $topLevelFolders = $tree.GetSubfolders("")
    if ($topLevelFolders) {
        $topLevelFolders | ForEach-Object { Write-Host "  â€¢ $_" -ForegroundColor Gray }
    }
}

# ç§»é™¤æ¨¡å—ï¼ˆæ¸…ç†ï¼‰
Remove-Module CategoryMap, FolderTree, PathConverter -ErrorAction SilentlyContinue

Write-Host "`nâœ… è„šæœ¬æ‰§è¡Œå®Œæˆ" -ForegroundColor Green

```

